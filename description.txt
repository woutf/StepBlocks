# StepBlocks - Product Requirements Document

## 1. Product Overview

StepBlocks is a step tracking system that divides daily step goals into customizable time blocks. Users create templates for different day types (weekday, weekend, etc.) and receive progress-based notifications throughout the day. The system consists of a phone app for configuration and a watch app for real-time tracking and notifications.

### Core Principles
- No automatic adjustments or AI intelligence
- User-defined targets remain fixed
- Progress-based notifications reduce noise
- Templates provide structure without rigidity

## 2. Data Models

### TimeBlock
- name: String (e.g., "Morning", "Work AM")
- startTime: Time (e.g., 09:00)
- endTime: Time (e.g., 12:00)
- targetSteps: Integer (e.g., 2000)
- notifyStart: Boolean
- notifyMid: Boolean
- notifyEnd: Boolean

### Template
- id: String
- name: String (e.g., "Weekday", "Weekend")
- timeBlocks: Array[TimeBlock]
- totalDailyTarget: Integer (calculated sum of all blocks)

### DayAssignment
- dayOfWeek: Integer (0=Sunday, 6=Saturday)
- templateId: String

### DailyProgress
- date: Date
- templateId: String
- blockProgress: Array[BlockProgress]

### BlockProgress
- blockName: String
- actualSteps: Integer
- targetSteps: Integer
- startNotificationSent: Boolean
- midNotificationSent: Boolean
- endNotificationSent: Boolean

## 3. Phone App Specification

### 3.1 Main Screen - "Templates"

**Layout:**
- Header: "StepBlocks" title
- List of template cards
- Floating Action Button (+) for new template

**Template Card Contains:**
- Template name (large text)
- Total daily steps (subtitle)
- Days assigned (e.g., "Mon, Tue, Wed, Thu, Fri")
- Edit icon button

**Interactions:**
- Tap card → Navigate to Template Detail
- Tap edit icon → Navigate to Edit Template
- Tap FAB → Navigate to Create Template
- Long press card → Delete confirmation dialog

### 3.2 Create/Edit Template Screen

**Layout:**
- Header with back arrow and "Save" button
- Template name input field
- "Time Blocks" section header with "Add Block" button
- List of time block cards
- Total daily steps display (auto-calculated)

**Time Block Card Contains:**
- Block name
- Time range (e.g., "9:00 AM - 12:00 PM")
- Step target
- Notification toggles (Start | Mid | End)
- Delete icon button

**Add Block Behavior:**
- When tapping "Add Block", the new block form pre-fills:
  - `startTime`: Set to `endTime` of the last block in the list
  - `endTime`: Set to `startTime + 3 hours` (or 23:59 if that would exceed midnight)
  - `name`: Empty (focus on this field)
  - `targetSteps`: Use average of existing blocks or 2000 if first block
- If no blocks exist yet, `startTime` defaults to 06:00

**Interactions:**
- Tap "Add Block" → Navigate to Add Time Block with pre-filled values
- Tap block card → Navigate to Edit Time Block
- Tap delete icon → Remove block (with confirmation)
- Tap "Save" → Validate and save template

**Validation Rules:**
- Template must have a name
- At least one time block required
- Time blocks cannot overlap
- Each block must have steps > 0

### 3.3 Add/Edit Time Block Screen

**Layout:**
- Header with back arrow and "Done" button
- Block name input field
- Start time picker
- End time picker
- Step target number input
- "Notifications" section header
- Three toggle switches:
  - "Start notification"
  - "Mid-point notification"
  - "End notification"

**Interactions:**
- Time pickers show native time selection
- Step input accepts numbers only
- "Done" validates and returns to template screen

### 3.4 Template Detail Screen

**Layout:**
- Header with template name and edit button
- Daily total steps display
- Visual timeline of blocks (horizontal bar chart)
- List of time blocks with details
- "Assign to Days" section
- Day selector (7 toggle buttons for each day)

**Day Selector:**
- Seven buttons: S M T W T F S
- Selected days highlighted
- Tap to toggle assignment

**Interactions:**
- Tap edit → Navigate to Edit Template
- Tap day button → Toggle template assignment
- Changes save automatically

### 3.5 History Screen

**Layout:**
- Calendar view (month)
- Days with data show completion percentage
- Below calendar: selected day's details

**Day Details Section:**
- Date header
- Template used
- Overall progress (e.g., "8,543 / 10,000 steps")
- List of blocks with progress bars
- Each block shows: name, actual/target, percentage

**Interactions:**
- Tap calendar day → Show that day's details
- Swipe calendar → Change month
- Pull to refresh → Sync with watch

### 3.6 Settings Screen

**Layout:**
- "Watch Connection" section
  - Connection status
  - "Sync Now" button
  - Last sync timestamp
- "Notifications" section
  - Master notification toggle
  - Vibration pattern selector
- "Data" section
  - "Export History" button
  - "Clear All Data" button
- "About" section
  - App version
  - "Help" link

**Vibration Patterns:**
- On Track: "Short Double Tap"
- Behind Pace: "Long Single"
- Goal Achieved: "Triple Tap"

## 4. Watch App Specification

### 4.1 Main Screen - "Now"

**Layout:**
- Current time (small, top)
- Current block name (large text)
- Circular progress indicator
- Steps count "2,451 / 3,000"
- Percentage "82%"
- Time remaining in block "1h 23m left"
- Daily total (bottom) "5,234 / 10,000 today"

**Interactions:**
- Swipe right → Navigate to Today screen
- Swipe down → Navigate to Quick Actions
- Tap progress → Show pace calculation

### 4.2 Today Screen

**Layout:**
- "Today" header with template name
- Scrollable list of all blocks
- Each block shows:
  - Name and time range
  - Progress bar
  - Step count (actual/target)
  - Status icon (✓ complete, → current, ⧖ upcoming)

**Visual Indicators:**
- Green bar: On track or complete
- Yellow bar: Behind pace (50-80% where should be)
- Red bar: Significantly behind (<50%)
- Gray bar: Future block

**Interactions:**
- Swipe left → Return to Now screen
- Tap block → Show block details popup
- Digital crown → Scroll through blocks

### 4.3 Quick Actions Screen

**Layout:**
- "Quick Adjust" header
- Current block target with +/- buttons
- "Today Only" label (emphasis on temporary)
- Daily total target with +/- buttons
- "Change Template" button

**Interactions:**
- Tap +/- → Adjust by 100 steps
- Long press +/- → Adjust by 500 steps
- Tap "Change Template" → Template selector

### 4.4 Template Selector Screen

**Layout:**
- "Select Template" header
- List of available templates
- Each shows name and total steps
- Current template highlighted

**Interactions:**
- Tap template → Apply and return to main
- Swipe right → Cancel and return

### 4.5 Block Details Popup

**Layout (overlay):**
- Block name and time range
- Large step count
- Progress percentage
- Pace information:
  - "Ahead by X steps" or
  - "Behind by X steps" or
  - "Perfect pace!"
- Time-based pace: "Need X steps/hour"

**Pace Calculation Logic:**
```
TimeElapsedPercentage = (CurrentTime - BlockStartTime) / (BlockEndTime - BlockStartTime)
ExpectedSteps = TargetSteps * TimeElapsedPercentage
PaceDelta = ActualSteps - ExpectedSteps

Display:
- If PaceDelta > 0: "Ahead by {PaceDelta} steps"
- If PaceDelta < 0: "Behind by {abs(PaceDelta)} steps"  
- If PaceDelta = 0 (±25 steps): "Perfect pace!"
```

**Interactions:**
- Tap outside → Dismiss
- Auto-dismiss after 5 seconds

## 5. Notification System

### 5.1 Notification Types

**Start Notification**
- Title: "[Block Name] Started"
- Body: "Goal: X,XXX steps"
- Vibration: Short double tap

**Mid-Point Notification (Behind Pace)**
- Title: "[Block Name]"
- Body: "X,XXX / X,XXX steps. Need XXX/hour"
- Vibration: Long single

**Mid-Point Notification (On Track)**
- Title: "[Block Name]"
- Body: "X,XXX / X,XXX steps. On track!"
- Vibration: Short double tap

**End Notification**
- Title: "[Block Name] Complete"
- Body: "X,XXX / X,XXX steps (XX%)"
- Vibration: Triple tap if ≥100%, short double tap if <100%

### 5.2 Notification Rules

**Mid-Point Notification Logic:**
```
TimeElapsedPercentage = 50% (at temporal midpoint)
ProgressPercentage = (ActualSteps / TargetSteps) * 100
BufferZone = 10%

Send notification if:
- ProgressPercentage < (TimeElapsedPercentage - BufferZone)
- In practice: Only notify if less than 40% complete at midpoint

This prevents nagging when user is close to target pace.
```

**General Rules:**
- Start: Sent at block start time if enabled
- Mid: Sent at temporal midpoint, only if behind pace (with buffer)
- End: Sent at block end time if enabled
- No notification sent if watch app is currently open
- Notifications respect system DND settings

## 6. Sync Behavior

### 6.1 Data Flow

**Phone → Watch:**
- Templates and assignments
- User preferences
- Sync triggered by:
  - App launch
  - Template save
  - Manual sync button

**Watch → Phone:**
- Step progress data
- Historical data (7 days)
- Sync triggered by:
  - Every block completion
  - App background sync (hourly)
  - Manual sync

### 6.2 Offline Behavior

**Watch:**
- Stores current template locally
- Tracks steps for 7 days offline
- Syncs when connection restored

**Phone:**
- Shows last synced data
- Displays sync status/errors
- Can edit templates offline (sync when connected)

## 7. Edge Cases

### 7.1 Time Block Overlaps
- Blocks cannot overlap in a template
- If phone time changes, maintain block integrity

### 7.2 Midnight Crossing
- Blocks cannot cross midnight
- Last block must end by 23:59

### 7.3 Template Changes Mid-Day
- Changing template preserves progress for completed blocks
- Current and future blocks use new template targets

### 7.4 Missing Step Data
- If step count unavailable, show "--"
- Do not send notifications without data

### 7.5 Multiple Template Days
- If multiple templates assigned to same day, most recently assigned wins
- Warning shown in UI when this occurs

## 8. User Flows

### 8.1 First Time Setup
1. Phone app launch → Welcome screen
2. Create first template → Guided creation
3. Assign to days → Today auto-selected
4. Connect watch → QR code or auto-detect
5. Watch app shows → Ready to track

### 8.2 Daily Usage
1. Morning → Start notification for first block
2. Throughout day → Progress notifications per settings
3. Evening → Check Today screen for summary
4. End of day → Final progress in History

### 8.3 Weekend Different Schedule
1. Friday night → Saturday template auto-activates
2. Saturday → Different blocks, different pace
3. Sunday night → Weekday template ready for Monday

---

## Implementation Notes for LLM

This document describes the complete feature set for StepBlocks. When implementing:
1. Start with core functionality (templates, basic tracking)
2. Implement watch app first (it's the primary interface)
3. Phone app can be simpler initially (just template management)
4. Notification system is critical for user experience
5. Sync can be simplified in MVP (manual sync only)

The watch app should be optimized for quick glances and minimal interaction. The phone app handles all complex configuration. Keep the watch UI simple and focus on clear, glanceable information.